<UserControl x:Class="Nivtropy.Views.TraverseDesignView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             d:DesignHeight="600"
             d:DesignWidth="1200">
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="7*" />
            <ColumnDefinition Width="3*" MinWidth="300" />
        </Grid.ColumnDefinitions>

        <!-- Левая панель: Таблица с данными -->
        <Border Grid.Column="0" Margin="8" BorderBrush="#FFB0B0B0" BorderThickness="1">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <!-- Заголовок -->
                <Border Grid.Row="0" Background="#FFF0F0F0" BorderBrush="#FFE0E0E0" BorderThickness="0,0,0,1" Padding="8">
                    <StackPanel>
                        <TextBlock Text="Сгенерированные данные измерений" FontSize="14" FontWeight="SemiBold" />
                        <TextBlock Text="Синтетические данные для экспорта в формате нивелира" FontSize="11" Foreground="#FF606060" Margin="0,2,0,0" />
                    </StackPanel>
                </Border>

                <!-- Таблица -->
                <DataGrid Grid.Row="1"
                          ItemsSource="{Binding Measurements}"
                          AutoGenerateColumns="False"
                          CanUserAddRows="False"
                          IsReadOnly="True"
                          HeadersVisibility="Column"
                          RowHeaderWidth="0"
                          GridLinesVisibility="All"
                          VerticalGridLinesBrush="#FFE0E0E0"
                          HorizontalGridLinesBrush="#FFE0E0E0">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="№" Binding="{Binding Index}" Width="50" />
                        <DataGridTextColumn Header="Точка" Binding="{Binding PointCode}" Width="*" MinWidth="80" />
                        <DataGridTextColumn Header="Station" Binding="{Binding StationCode}" Width="*" MinWidth="100" />
                        <DataGridTextColumn Header="Rb, м" Binding="{Binding Rb_m, StringFormat=F4}" Width="100" />
                        <DataGridTextColumn Header="Rf, м" Binding="{Binding Rf_m, StringFormat=F4}" Width="100" />
                        <DataGridTextColumn Header="HD назад, м" Binding="{Binding HD_Back_m, StringFormat=F2}" Width="110" />
                        <DataGridTextColumn Header="HD вперёд, м" Binding="{Binding HD_Fore_m, StringFormat=F2}" Width="110" />
                        <DataGridTextColumn Header="Высота, м" Binding="{Binding Height_m, StringFormat=F4}" Width="100" />
                    </DataGrid.Columns>
                </DataGrid>
            </Grid>
        </Border>

        <!-- Правая панель: Настройки и управление -->
        <Border Grid.Column="1" Margin="8" BorderBrush="#FFB0B0B0" BorderThickness="1">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel Margin="12">
                    <!-- Кнопки управления -->
                    <Grid Margin="0,0,0,16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="8" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <Button Grid.Column="0"
                                Content="Сгенерировать"
                                Height="36"
                                Command="{Binding GenerateCommand}"
                                Background="#FF0078D4"
                                Foreground="White"
                                BorderThickness="0"
                                FontWeight="SemiBold">
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="Button">
                                                <Border Background="{TemplateBinding Background}"
                                                        CornerRadius="3"
                                                        Padding="8">
                                                    <ContentPresenter HorizontalAlignment="Center"
                                                                    VerticalAlignment="Center" />
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="#FF106EBE" />
                                        </Trigger>
                                        <Trigger Property="IsEnabled" Value="False">
                                            <Setter Property="Background" Value="#FFB0B0B0" />
                                            <Setter Property="Foreground" Value="#FF808080" />
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>

                        <Button Grid.Column="2"
                                Content="Экспортировать"
                                Height="36"
                                Command="{Binding ExportCommand}"
                                Background="#FF28A745"
                                Foreground="White"
                                BorderThickness="0"
                                FontWeight="SemiBold">
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="Button">
                                                <Border Background="{TemplateBinding Background}"
                                                        CornerRadius="3"
                                                        Padding="8">
                                                    <ContentPresenter HorizontalAlignment="Center"
                                                                    VerticalAlignment="Center" />
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="#FF218838" />
                                        </Trigger>
                                        <Trigger Property="IsEnabled" Value="False">
                                            <Setter Property="Background" Value="#FFB0B0B0" />
                                            <Setter Property="Foreground" Value="#FF808080" />
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                    </Grid>

                    <!-- Формат экспорта -->
                    <GroupBox Header="Формат экспорта" Margin="0,0,0,16">
                        <StackPanel Margin="8">
                            <RadioButton Content="Нивелир (*.txt)"
                                        IsChecked="{Binding FormatNivelir}"
                                        GroupName="ExportFormat" />
                        </StackPanel>
                    </GroupBox>

                    <!-- Настройки генерации -->
                    <GroupBox Header="Настройки генерации" Margin="0,0,0,16">
                        <StackPanel Margin="8">
                            <TextBlock Text="СКО для измерений, мм:" Margin="0,0,0,4" />
                            <TextBox Text="{Binding StdDevMeasurement, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                    ToolTip="Стандартное отклонение для обычных измерений"
                                    Margin="0,0,0,12" />

                            <TextBlock Text="СКО для грубых ошибок, мм:" Margin="0,0,0,4" />
                            <TextBox Text="{Binding StdDevGrossError, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                    ToolTip="Стандартное отклонение для грубых ошибок"
                                    Margin="0,0,0,12" />

                            <TextBlock Text="Частота грубых ошибок (каждая N-ная):" Margin="0,0,0,4" />
                            <TextBox Text="{Binding GrossErrorFrequency, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                    ToolTip="Каждая N-ная станция будет иметь грубую ошибку (0 = отключить)"
                                    Margin="0,0,0,0" />
                        </StackPanel>
                    </GroupBox>

                    <!-- Источник данных -->
                    <GroupBox Header="Источник данных" Margin="0,0,0,16">
                        <StackPanel Margin="8">
                            <TextBlock Text="Файл с результатами расчётов:" Margin="0,0,0,4" FontWeight="SemiBold" />
                            <TextBlock Text="{Binding SourceFilePath, TargetNullValue=Не выбран}"
                                      TextWrapping="Wrap"
                                      Foreground="#FF606060"
                                      Margin="0,0,0,8" />
                            <Button Content="Открыть файл..."
                                   Command="{Binding OpenFileCommand}"
                                   HorizontalAlignment="Stretch"
                                   Height="30" />
                        </StackPanel>
                    </GroupBox>

                    <!-- Место для будущего рисунка -->
                    <GroupBox Header="Вид сверху (в разработке)" Margin="0,0,0,0">
                        <Border Height="200"
                               Background="#FFF9F9F9"
                               BorderBrush="#FFE0E0E0"
                               BorderThickness="1"
                               Margin="8">
                            <TextBlock Text="Визуализация будет добавлена позже"
                                      VerticalAlignment="Center"
                                      HorizontalAlignment="Center"
                                      Foreground="#FF808080"
                                      FontStyle="Italic" />
                        </Border>
                    </GroupBox>
                </StackPanel>
            </ScrollViewer>
        </Border>
    </Grid>
</UserControl>
