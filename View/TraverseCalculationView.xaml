<UserControl x:Class="Nivtropy.Views.TraverseCalculationView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:converters="clr-namespace:Nivtropy.Converters"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             d:DesignHeight="450"
             d:DesignWidth="800">
    <UserControl.Resources>
        <converters:MethodDeltaConverter x:Key="MethodDeltaConverter" />
    </UserControl.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <StackPanel Grid.Row="0"
                    Margin="8"
                    Orientation="Vertical">
            <TextBlock Text="Расчёт нивелирного хода"
                       FontSize="16"
                       FontWeight="SemiBold" />
            <TextBlock Margin="0,4,0,0"
                       Text="Суммарные параметры всех загруженных ходов." />
            <StackPanel Orientation="Horizontal"
                        Margin="0,12,0,0">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="Метод:" VerticalAlignment="Center" />
                    <TextBlock Text="{Binding SelectedMethod.Display}"
                               FontWeight="SemiBold"
                               Margin="8,0,0,0"
                               VerticalAlignment="Center" />
                </StackPanel>
                <StackPanel Orientation="Horizontal" Margin="16,0,0,0">
                    <TextBlock Text="Класс:" VerticalAlignment="Center" />
                    <TextBlock Text="{Binding SelectedClass.Display}"
                               FontWeight="SemiBold"
                               Margin="8,0,0,0"
                               VerticalAlignment="Center" />
                </StackPanel>
            </StackPanel>
        </StackPanel>

        <Grid Grid.Row="1" Margin="8">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <StackPanel Grid.Row="0">
                <TextBlock Text="Станций" FontWeight="SemiBold" />
                <TextBlock Text="{Binding StationsCount}" />
            </StackPanel>
            <StackPanel Grid.Row="0" Grid.Column="1">
                <TextBlock Text="ΣΔh, м" FontWeight="SemiBold" />
                <TextBlock Text="{Binding Closure, StringFormat=+0.0000;-0.0000;0.0000}" />
            </StackPanel>
            <StackPanel Grid.Row="0" Grid.Column="2">
                <TextBlock Text="Решающий допуск, м" FontWeight="SemiBold" />
                <TextBlock Text="{Binding AllowableClosure, StringFormat=0.0000}" />
            </StackPanel>

            <StackPanel Grid.Row="1" Grid.Column="0" Margin="0,16,0,0">
                <TextBlock Text="Сумма HDback, м" FontWeight="SemiBold" />
                <TextBlock Text="{Binding TotalBackDistance, StringFormat=0.00}" />
            </StackPanel>
            <StackPanel Grid.Row="1" Grid.Column="1" Margin="0,16,0,0">
                <TextBlock Text="Сумма HDfore, м" FontWeight="SemiBold" />
                <TextBlock Text="{Binding TotalForeDistance, StringFormat=0.00}" />
            </StackPanel>
            <StackPanel Grid.Row="1" Grid.Column="2" Margin="0,16,0,0">
                <TextBlock Text="Средняя длина, м" FontWeight="SemiBold" />
                <TextBlock Text="{Binding TotalAverageDistance, StringFormat=0.00}" />
            </StackPanel>

            <StackPanel Grid.Row="2" Grid.Column="0" Margin="0,16,0,0">
                <TextBlock Text="Допуск по методу, м" FontWeight="SemiBold" />
                <TextBlock Text="{Binding MethodTolerance, StringFormat=0.0000}" />
            </StackPanel>
            <StackPanel Grid.Row="2" Grid.Column="1" Margin="0,16,0,0">
                <TextBlock Text="Допуск по классу, м" FontWeight="SemiBold" />
                <TextBlock Text="{Binding ClassTolerance, StringFormat=0.0000}" />
            </StackPanel>
            <StackPanel Grid.Row="2" Grid.Column="2" Margin="0,16,0,0">
                <TextBlock Text="Δh по модулю, м" FontWeight="SemiBold" />
                <TextBlock Text="{Binding ClosureAbsolute, StringFormat=0.0000}" />
            </StackPanel>
            <StackPanel Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="3" Margin="0,16,0,0" Orientation="Vertical">
                <TextBlock Text="{Binding SelectedMethod.Description}" />
                <TextBlock Text="{Binding SelectedClass.Description}"
                           Margin="0,4,0,0" />
            </StackPanel>
        </Grid>

        <Border Grid.Row="2" Margin="8" BorderBrush="#FFB0B0B0" BorderThickness="1">
            <DockPanel>
                <TextBlock DockPanel.Dock="Top"
                           Padding="4"
                           Background="#FFEAEAEA"
                           Text="{Binding ClosureVerdict}" />
                <DataGrid x:Name="RowsGrid"
                          ItemsSource="{Binding Rows}"
                          AutoGenerateColumns="False"
                          CanUserAddRows="False"
                          IsReadOnly="True"
                          HeadersVisibility="Column"
                          Margin="0"
                          RowHeaderWidth="0">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="№" Binding="{Binding Index}" Width="60" />
                        <DataGridTextColumn Header="Ход" Binding="{Binding LineName}" Width="120" />
                        <DataGridTextColumn Header="Станция" Binding="{Binding Station}" Width="200" />
                        <DataGridTextColumn Header="Rb, м" Binding="{Binding Rb_m, StringFormat=F4}" Width="100" />
                        <DataGridTextColumn Header="Rf, м" Binding="{Binding Rf_m, StringFormat=F4}" Width="100" />
                        <DataGridTextColumn Header="Δh, м" Binding="{Binding DeltaH, StringFormat=+0.0000;-0.0000;0.0000}" Width="120" />
                        <DataGridTemplateColumn Header="Δh (метод), м" Width="140">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock>
                                        <TextBlock.Text>
                                            <MultiBinding Converter="{StaticResource MethodDeltaConverter}" StringFormat="+0.0000;-0.0000;0.0000">
                                                <Binding Path="DeltaH" />
                                                <Binding Path="DataContext.MethodOrientationSign" RelativeSource="{RelativeSource AncestorType={x:Type DataGrid}}" />
                                            </MultiBinding>
                                        </TextBlock.Text>
                                    </TextBlock>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                        <DataGridTextColumn Header="HDback, м" Binding="{Binding HdBack_m, StringFormat=0.00}" Width="110" />
                        <DataGridTextColumn Header="HDfore, м" Binding="{Binding HdFore_m, StringFormat=0.00}" Width="110" />
                    </DataGrid.Columns>
                </DataGrid>
            </DockPanel>
        </Border>
    </Grid>
</UserControl>
